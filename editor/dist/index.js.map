{"version":3,"file":"index.js","sourceRoot":"","sources":["../src/index.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable */\n\n\n\n\n\nimport Vex from \"vexflow\";\nimport * as lodash from \"lodash\";\n\n\n\nconst REST_POSITIONS = (key:string)=>{\n\nswitch(key){\n  case \"q\":  return \"b/4\";\n  case \"h\":  return \"b/4\";\n  case \"w\": return \"e/5\";\n  case \"8\": return \"b/4\";\n  case \"16\":  return \"b/4\";\n  case \"32\":  return \"b/4\";\n  default: return \"\";\n}\n};\n\nconst NOTE_VAlUES =  (key:string)=>{\n    switch(key){ \n  case \"c\": return 1;\n  case \"d\": return 2;\n  case \"e\": return 3;\n  case \"f\": return 4;\n  case \"g\": return 5;\n  case \"a\": return 6;\n  case \"b\": return 7;\n  default: return 0;\n    }\n}\n\nconst DURATION_VALUES =  (key:string)=>{\n  switch(key){ \ncase \"w\": return 32;\ncase \"h\": return 16;\ncase \"q\": return 8;\ncase \"8\": return 4;\ncase \"16\": return 2;\ncase \"32\": return 1;\ndefault: return 0;\n  }\n}\n\n// types  \ninterface ed_note{\n    clef: any; \n    duration : string,\n    keys: string[],\n    accidentals: ( string | null )[],\n    dotted?: boolean;\n    isRest: boolean,\n    staveIndex: number,\n    noteIndex: number\n }\n\n interface ed_tie{\n   first_note: string,\n   last_note: string,\n   first_indices: string,\n   last_indices: string\n }\n\ninterface ed_selected_note {staveIndex:number, noteIndex:number};\n  \n\n\n interface ed_stave{\n     notes:ed_note[]\n }\n\n interface ed_sheet{\n     staves: ed_stave[],\n     ties: ed_tie[]\n }\n\n interface cursor{\n     _staveIndex?: number,\n     _noteIndex?: number,\n     noteIndex: any,\n     staveIndex:any\n }\n\ninterface ed_selected {\n    _staves?: any[]\n    _notes?: {staveIndex:number, noteIndex:number}[],\n    cursor: cursor,\n    notes: {staveIndex:number, noteIndex:number}[],\n    staves: number[],\n}\n\n interface ed_state {\n     sheet: string,\n     selected: string\n }\n\n\n\nclass Editor {\n  //eslint-disable-next-line\n\n  private keySig:string = \"C\";\n  private timeSigTop: number = 4;\n  private timeSigBottom: number = 4;\n  private clef:string = \"treble\";\n  private accidental:(string | null) = \"\";\n  private staveWidth:number = 400;\n  private staveHeight:number = 140;\n  private noteWidth:number = 100;\n  private dotted:boolean = false;\n  private eventsAdded = false;\n  private shiftActive = false;\n  private ctrlActive = false;\n  private metaActive = false;\n  private svgElm:HTMLElement;\n  private renderer:any;\n  private ctx:Vex.Flow.CanvasContext;\n  private  sheet: ed_sheet= { \n    staves: [],\n    ties: [] \n  }\n\n\n\n  private  states:ed_state[]= [];\n  private  undoStates:ed_state[] = []\n\n  \n\n  private  selected: ed_selected = {\n    _staves: [] as ed_stave[],\n    _notes:[{staveIndex: 0 , noteIndex: 0}],\n    cursor:{\n      _staveIndex: 0,\n      _noteIndex:0,\n\n      set noteIndex(value:any){ this._noteIndex = parseInt(value)},\n      get noteIndex(){\n        return this._noteIndex},\n      set staveIndex(value:any){ this._staveIndex = parseInt(value)},\n      get staveIndex(){ \n        return this._staveIndex\n      }\n\n    },\n\n    get notes(){\n        return this._notes?.map(n=> {\n          return {...n, staveIndex: n.staveIndex, noteIndex: n.noteIndex } }) as  ed_note[]\n    },\n\n    set notes(value){\n      if(!lodash.isArray(value)) this._notes = this._notes;\n      else {\n        \n        const sortedNotes = value.sort((a,b)=> a.noteIndex - b.noteIndex);\n        this._notes = sortedNotes; }\n    },\n\n    get staves(){\n      return this._staves?.map(s=> parseInt(s))\n    },\n\n    set staves(value:any) {\n        this._staves = value;\n    }\n\n  };\n\n  mousePos:any = {\n    previous:{\n      x:0,\n      y:0,\n    },\n    current:{\n      x:0,\n      y:0\n    }\n  };\n\n\n  constructor(svgcontainer:HTMLElement) {\n  \n    this.svgElm = svgcontainer;\n     this.renderer   = new Vex.Flow.Renderer(\n        svgcontainer,\n        Vex.Flow.Renderer.Backends.SVG\n      );\n\n     this.ctx = this.renderer.getContext();\n\n    // event listerners\n\n    // add first stave by default\n    this.addStave();\n    this.addStave();\n    this.Draw();\n    if (!this.eventsAdded) {\n      this.addEventListeners(this.svgElm);\n      this.addKeyboardListeners();\n      this.eventsAdded = true;\n    }\n\n        \n\n    // test case:\n\n    const test = ()=>{\n\n      this.selected.notes= [{\n        staveIndex:0,\n        noteIndex:0\n      }]\n\n      this.addNote(\"c/4\")\n      this.addNote(\"e/4\")\n      this.addNote(\"g/4\")\n      this.replaceNote(\"c/4\",\"g/5\")\n      this.changeOctave(1,\"c/4\")\n      this.changeOctave(-1,\"g/4\")\n      \n    }\n\n    // run test \n\n    test();\n    this.Draw()\n  }\n\n  saveState(){\n    const sheet = JSON.stringify(this.sheet);\n    const selected = JSON.stringify(this.selected);\n    this.states.push({sheet,selected}) ; console.log(\"state saved\",this.states);\n  }\n  \n\n  undo(){\n    if(!this.states.length) return;\n    const currState ={\n      sheet: JSON.stringify(this.sheet),\n      selected: JSON.stringify(this.selected)\n    }\n\n    this.undoStates.push(currState)\n\n    const previousState = this.states.pop()\n    if(previousState){\n    this.sheet = JSON.parse(previousState.sheet)\n    this.selected = JSON.parse(previousState.selected)\n    this.Draw();\n    }\n  }\n\n  redo(){\n    if(!this.undoStates.length) return;\n    this.saveState();\n    const undoSate:any = this.undoStates.pop();\n    this.sheet = JSON.parse(undoSate.sheet);\n    this.selected = JSON.parse(undoSate.selected);\n\n  }\n\n  addStave(index = this.sheet.staves ? this.sheet.staves.length : 0) {\n    this.sheet.staves = this.sheet.staves || [];\n    \n    // fill bar with rests\n\n    let notes:ed_note[] = new Array(4).fill({keys:[REST_POSITIONS(\"q\")] ,duration:\"q\",isRest:true})\n                            .map((n,i)=> { return  {...n,accidentals:[null],staveIndex:index, noteIndex:i} })\n    this.sheet.staves.splice(index, 0, {notes});\n  }\n\n  addNote(noteName:string) {\n    // modify the rest of the stave to join the notes\n\n    let notes = this.selected.notes;\n    notes = notes.map((selectedNote:ed_selected_note)=>{\n\n    const  staveIndex = selectedNote.staveIndex;\n    const noteIndex = selectedNote.noteIndex;\n    const note = this.sheet.staves[staveIndex].notes[noteIndex];\n    // if key arledy exists then don't add it again;\n    \n\n    let stave = this.sheet.staves[note.staveIndex];\n    let isRest = note.isRest;\n    let duration =  note.duration.replace('r','');\n    let keys = isRest ? [noteName] :   lodash.uniq([...note.keys, noteName]);\n    let accidentals =  note.accidentals ? [...note.accidentals, this.accidental]: this.accidental? [this.accidental] : [null];\n   \n\n    let newNote = {keys,duration,isRest:false,staveIndex:  note.staveIndex,noteIndex: note.noteIndex, accidentals, clef: note.clef};\n    stave.notes[note.noteIndex] = newNote;\n    this.sheet.staves[note.staveIndex] = stave;\n    return newNote;\n\n  })\n  this.selected.notes = notes;\n  }\n\n  //TODO: implement \n  changeDuration(){\n    \n  \n  }\n\n // note editing functions \n\n  changeOctave(octave:number,keyNote:string){\n\n\n   this.selected.notes.map(selectedNote=>{\n\n      const staveIndex = selectedNote.staveIndex;\n      const noteIndex = selectedNote.noteIndex;\n      const keyIndex = this.sheet.staves[staveIndex].notes[noteIndex].keys.indexOf(keyNote);\n      const note = this.sheet.staves[staveIndex].notes[noteIndex].keys[keyIndex]\n\n      if(!note){\n        console.error(\"note not found\");\n        return;\n      }\n\n      const [upper , lower ] = note.split(\"/\");\n\n\n      const newNote = `${upper}/${parseInt(lower)+octave}`;\n\n      // replace the note \n\n    this.sheet.staves[staveIndex].notes[noteIndex].keys[keyIndex] = newNote;\n  \n          \n    })\n\n  }\n\n  replaceNote(currentNote:string, newNote: string){ \n\n    this.selected.notes.map(selectedNote=>{\n\n      const staveIndex = selectedNote.staveIndex;\n      const noteIndex = selectedNote.noteIndex;\n      const keyIndex = this.sheet.staves[staveIndex].notes[noteIndex].keys.indexOf(currentNote);\n      const note = this.sheet.staves[staveIndex].notes[noteIndex].keys[keyIndex]\n\n      if(!note){\n        console.error(\"note not found\");\n        return;\n      }\n\n      // replace the note \n\n    this.sheet.staves[staveIndex].notes[noteIndex].keys[keyIndex] = newNote;\n  \n          \n    })\n\n  }\n\n  changeaccidental(key:string, accidental: string){ \n\n    // check if accidental type is invalid\n\n    switch(true){\n      case accidental === \"n\":\n      case accidental === \"b\":\n      case accidental === \"bb\":\n      case accidental === \"#\":\n      case accidental === \"##\":\n      case accidental === null : break;\n      default : {\n        console.error(\"incorrect accidnetal value\");\n        return ;\n      }\n    }    \n\n    this.selected.notes.map(selectedNote=>{\n\n      const staveIndex = selectedNote.staveIndex;\n      const noteIndex = selectedNote.noteIndex;\n      const keyIndex = this.sheet.staves[staveIndex].notes[noteIndex].keys.indexOf(key);\n      const accidentalIndex = keyIndex;\n      const note = this.sheet.staves[staveIndex].notes[noteIndex].keys[keyIndex]\n\n      if(!note){\n        console.error(\"note not found\");\n        return;\n      }\n\n      // replace the note \n    this.sheet.staves[staveIndex].notes[noteIndex].accidentals[accidentalIndex] = accidental;\n  \n          \n    })\n\n  }\n\n\n  deleteNotes() {\n    // convert the note into a rest\n    let notes = this.selected.notes;\n    notes = notes.map((note:ed_selected_note)=>{\n\n    let stave = this.sheet.staves[note.staveIndex];\n    let oldNote = stave.notes[note.noteIndex];\n    let newNote:ed_note = {\n      keys: [REST_POSITIONS(oldNote.duration)],\n      duration: oldNote.duration,\n      isRest:true,\n      staveIndex:oldNote.staveIndex,\n      noteIndex: oldNote.noteIndex,\n      accidentals: [],\n      clef: oldNote.clef\n    }\n    stave.notes[note.noteIndex] = newNote;\n    this.sheet.staves[note.staveIndex] = stave;\n    return newNote;\n  })\n\n  this.selected.notes = notes;\n\n    \n  }\n\n  // note sorting fuction \n\n private   compareNotes (noteA:string, noteB:String) {\n    const toneA = noteA.charAt(0);\n    const toneB = noteB.charAt(0);\n    const octaveA = parseInt(noteA.charAt(1));\n    const octaveB = parseInt(noteB.charAt(1));\n  \n    if (octaveA === octaveB) {\n      // console.log('same octave');\n      if ( NOTE_VAlUES(toneA) > NOTE_VAlUES(toneB)) {\n        return 1;\n      } else if ( toneA == toneB) {\n        return 0;\n      } else {\n        return -1;\n      }\n    } else if (octaveA > octaveB) {\n      return 1;\n    } else {\n      return -1;\n    }\n  }\n\n  Draw() {\n    this.ctx.clear();\n    let staveXpos = 10;\n    let staveWidth = 0;\n    this.sheet.staves.map((s, staveIndex) => {\n\n      \n      staveXpos += staveWidth;\n      staveWidth = this.noteWidth*(s.notes.length  < 4 ? 4 :  s.notes.length   );\n      // drave the stave first , add timesignature\n      let stave = new Vex.Flow.Stave(\n        staveXpos,\n        40,\n        staveWidth \n      );\n      (stave as unknown as HTMLElement).setAttribute(\"id\", \"vf-\" + staveIndex);\n    \n\n      if(staveIndex === 0){\n          stave.addTimeSignature(\"4/4\");\n          stave.addClef(this.clef);\n      }\n\n      stave.setContext(this.ctx).draw(); \n\n      //add selectable overlay\n      (this.ctx as any).rect(stave.getX(), (stave as any).y , stave.getWidth(), this.staveHeight, {\n        class: \"vf-measureRect\",\n        id: \"vf-\" + staveIndex,\n        fill: \"transparent\",\n      });\n\n      // draw the notes \n\n      let staveNotes =  s.notes.map(n=>{\n\n\n       // sort notes according to keys\n       n.accidentals = n.accidentals || [null];\n       let keys = n.keys.map((k,i)=> {return { index:i, key: k, accidental: n.accidentals[i]  }})\n       keys = keys.sort((a,b)=> this.compareNotes( a.key.split(\"/\").join('') , b.key.split(\"/\").join('') ) );\n\n       let sortedKeys = keys.map(k=>k.key);\n       let sortedAccidentals = keys.map(k=>k.accidental)\n\n       console.log(\"unsorted\",n.keys)\n       console.log(\"sorted\",sortedKeys)\n\n     \n       \n\n       let  staveNote: Vex.Flow.StaveNote | any = new Vex.Flow.StaveNote({\n          clef: this.clef,\n          keys: sortedKeys,\n          duration: !n.isRest? n.duration : n.duration+\"r\",\n          auto_stem: true,\n        });\n\n        // add accidental \n        !n.isRest && sortedAccidentals.length && sortedAccidentals.map((accidental,index)=>{\n          if(accidental)\n          staveNote.addAccidental(index, new Vex.Flow.Accidental(accidental))\n        })\n\n        // add dot if dotted\n        \n        if (n.dotted){\n            (staveNote as Vex.Flow.StaveNote).addDotToAll();\n        }\n\n        staveNote.setAttribute(\"id\", `${n.staveIndex}__${n.noteIndex}`);\n        return staveNote\n       })\n    \n      \n      console.log(\"numb\",staveNotes.length);\n      console.log(\"bval\",this.timeSigBottom)\n      let voice = new Vex.Flow.Voice({ num_beats: this.timeSigTop, beat_value: this.timeSigBottom });\n      voice.addTickables(staveNotes);\n      \n       Vex.Flow.Formatter.FormatAndDraw(this.ctx,stave,staveNotes)\n      \n\n    });\n\n    // highlight the selected notes\n    this.selected.notes.map((sn:ed_selected_note)=>{\n      let selectedNote:any = this.svgElm.querySelector(\n        `#vf-${sn.staveIndex}__${\n          sn.noteIndex\n        }`\n      );\n      this._highlightNoteElement(selectedNote, \"red\");\n    })\n\n\n    this.selected.staves.map((staveIndex:number)=>{\n      this._highlightStaveElement(\n        this.svgElm.querySelector(\n          `#vf-${staveIndex}`\n        ),\n        \"lightblue\"\n      );\n    })\n\n    \n\n\n\n  }\n\n private  _getSelectedElement(event:any) {\n    let ele = event.target;\n    while (\n      ele.classList.value.indexOf(\"vf-stavenote\") < 0 &&\n      ele.classList.value.indexOf(\"vf-measureRect\") < 0\n    ) {\n      ele = ele.parentElement;\n    }\n\n    // prevent the cursor note form getting selected\n    let id = ele.id;\n    if (id.indexOf(\"auto\") > -1) return [];\n\n    id = id.split(\"-\")[1].split(\"__\");\n\n    // return an element only if there is a valid id selected\n    return [\n      ele,\n      ele.classList.value.indexOf(\"vf-stavenote\") > -1 ? \"note\" : \"stave\",\n      ...id,\n    ];\n  }\n\n private  _highlightNoteElement(ele:(HTMLElement | null), color:string = \"black\") {\n    if (!ele) {\n      console.warn(\"No element was passed\");\n      return;\n    }\n    ele.querySelectorAll(\"*\").forEach((e:any) => {\n      e.style.fill = color;\n      e.style.stroke = color;\n    });\n  }\n\n  // eslint-disable-next-line no-unused-vars\n private _highlightStaveElement(ele:any, color = \"transparent\") {\n    ele.style.fill = color;\n    ele.style.opacity = \"0.4\";\n  }\n\n  addEventListeners(svgElem:HTMLElement) {\n    // helper function for finding the selected element:\n\n    svgElem.addEventListener(\"click\", (event) => {\n      event.preventDefault();\n\n\n      // eslint-disable-next-line no-unused-vars\n      let [ele, type, staveIndex, noteIndex] = this._getSelectedElement(event);\n\n      switch (type) {\n        case \"note\": {\n\n\n\n          //  \n          this.selected.cursor.staveIndex = staveIndex;\n          this.selected.cursor.noteIndex = noteIndex;\n          \n          this._addtoSelectedNotes(  this.sheet.staves[staveIndex].notes[noteIndex])\n          break;\n        }\n\n        case \"stave\": {\n     \n\n          this._addtoSelectedStaves(staveIndex);\n          break;\n        }\n      }\n      this.Draw();\n\n    });\n\n    svgElem.addEventListener(\"blur\", () => {\n      this.Draw();\n    });\n\n  }\n\n  // Methods for drawing cursor note\n\n  private _addtoSelectedNotes(note:ed_note){\n    if(this.shiftActive){\n      let notes = lodash.clone(this.selected.notes);\n      notes.push(note)\n      notes = lodash.uniq(notes);\n      this.selected.notes = notes;\n    }\n    else{\n      this.selected.notes = [note];\n    }\n  }\n\n  private _addtoSelectedStaves(stave:number){\n    if(this.shiftActive){\n      let staves = lodash.clone(this.selected.staves);\n      staves.push(stave)\n      staves = lodash.uniq( staves );\n      this.selected.staves = staves;\n    }\n    else{\n      this.selected.staves = [stave];\n    }\n  }\n\n  getMousePos(canvas:HTMLElement, evt:MouseEvent) {\n    var rect = canvas.getBoundingClientRect();\n    return {\n      x: evt.clientX - rect.left,\n      y: evt.clientY - rect.top,\n    };\n  }\n\n\n  splitSelectedNote(){\n    let stave = this.sheet.staves[this.selected.cursor.staveIndex];\n    let notes = stave.notes;\n    let selectedNote = stave.notes[this.selected.cursor.noteIndex];\n    let duration = selectedNote.duration.replace('r','') ;\n    let keys = selectedNote.keys;\n    let accidentals = selectedNote.accidentals;\n    let isRest = selectedNote.isRest;\n    let clef = selectedNote.clef;\n    let newNotes = new Array(2).fill(null)\n    // create a new duration\n\n    switch(duration){\n      case \"w\": duration = \"h\"; break;\n      case \"h\": duration= \"q\"; break;\n      case \"q\":  duration =\"8\"; break;\n      case \"8\": duration = \"16\"; break;\n      case \"16\": duration = \"32\"; break;\n      default: return ;\n    }\n\n    newNotes = newNotes.map( () => { return {\n      clef,\n      keys,\n      duration,\n      isRest,\n      accidentals\n\n    }\n    })\n\n    notes.splice(this.selected.cursor.noteIndex,1,...newNotes);\n    // remap ids \n\n    notes = notes.map((n,i) => {\n    n.staveIndex = this.selected.cursor.staveIndex;\n    n.noteIndex= i;\n    return n \n    \n  } )\n  stave.notes = notes;\n  this.setCursor(this.selected.cursor.staveIndex,this.selected.cursor.noteIndex+1);\n\n    \n  }\n\n\n\n  // TODO:  handle case for merge which creates dotted notes \n  mergeNotes(){\n\n      const selectedNotes: ed_note[] = this.selected.notes.map(sn=> {\n\n        const  staveIndex = sn.staveIndex;\n        const noteIndex = sn.noteIndex;\n        const note = this.sheet.staves[staveIndex].notes[noteIndex];\n        return note ;\n      })\n\n      const newNote:ed_note = selectedNotes.reduce((a:any,b:any)=>{\n\n          let mergedDuration:string='';\n          let mergedDurationValue: number =\n            DURATION_VALUES(a.duration) + DURATION_VALUES(b.duration)\n            let dotted = false;\n\n            debugger;\n          switch(mergedDurationValue){\n\n          // cases for regular notes \n            \n            case 2 : mergedDuration = \"16\"; break;\n            case 4 : mergedDuration =  \"8\"; break;\n            case 8 : mergedDuration = \"q\"; break;\n            case 16: mergedDuration = \"h\"; break;\n            case 32: mergedDuration = \"w\"; break;\n\n          // handle cases for dotted notes \n\n          //dotted 16th note\n\n          case 3: mergedDuration = \"16\" ; dotted = true; break;\n          //dotted 8th note\n          case 6: mergedDuration = \"8\"; dotted = true; break;\n          // dotted quater ntoe \n          case 12: mergedDuration = \"q\"; dotted = true; break;\n          // dotted half note  \n          case 24: mergedDuration = \"h\"; dotted = true; break;\n          \n\n          }\n\n          if(!mergedDuration){\n            console.warn(\"cannot merge\");\n          }\n\n         let keys1 = a.isRest?  [] : a.keys;\n         let keys2 = b.isRest? [] : b.keys;\n         let  keys  = [...keys1, ...keys2];\n          keys = keys.length ? lodash.uniq(keys) : [REST_POSITIONS(mergedDuration)] ;\n\n          return {\n            ...a,\n            isRest: a.isRest && b.isRest,\n            keys,\n            duration:mergedDuration,\n            dotted,\n        }\n          \n      })\n\n\n      newNote.staveIndex =  this.selected.notes[0].staveIndex;\n      newNote.noteIndex = this.selected.notes[0].noteIndex;\n\n      this.sheet.staves[this.selected.notes[0].staveIndex].notes.splice(this.selected.notes[0].noteIndex,this.selected.notes.length,newNote)\n      this.selected.notes = [newNote]\n\n\n  }\n\n  setCursor(staveIndex:number,noteIndex:number){\n    this.selected.cursor ={\n      staveIndex: staveIndex,\n      noteIndex: noteIndex\n    }\n    let selectedNote = this.sheet.staves[staveIndex].notes[noteIndex]\n    this._addtoSelectedNotes(selectedNote)\n  }\n\n  getCursorNote() {\n      //TODO this is depricated;\n    let staveIndex = this.selected.cursor.staveIndex;\n    let noteIndex = this.selected.cursor.noteIndex;\n    if (!staveIndex && noteIndex) return [];\n    // find the mouse position and return the correct note for that position.\n    var y= 0;\n    var found;\n    var cursorNoteKey;\n    // var y = this.selected.measure.y;\n    var notesArray = [\"c/\", \"d/\", \"e/\", \"f/\", \"g/\", \"a/\", \"b/\"];\n    var count = 0;\n\n    for (var i = 5; i >= 0; i--) {\n      for (var l = 0; l < notesArray.length; l++) {\n        var noteOffset = count * 35 - (l * 5 - 17);\n        if (\n          this.mousePos.current.y >= y + noteOffset &&\n          this.mousePos.current.y <= 5 + y + noteOffset\n        ) {\n          cursorNoteKey = notesArray[l] + (i + 1);\n          found = true;\n          break;\n        }\n        if (found == true) {\n          break;\n        }\n      }\n      count++;\n    }\n    return [cursorNoteKey, staveIndex, noteIndex];\n  }\n\n  // cursor manipulation methods\n  _cursorForward() {\n    let sIndex = this.selected.cursor.staveIndex;\n    let nIndex = this.selected.cursor.noteIndex;\n    \n\n    switch (true) {\n      case nIndex < this.sheet.staves[sIndex].notes.length - 1: {\n        nIndex = nIndex + 1;\n        break;\n      }\n      case nIndex === this.sheet.staves[sIndex].notes.length - 1: {\n        if (sIndex < this.sheet.staves.length - 1) {\n          sIndex = sIndex + 1;\n          nIndex = 0;\n        }\n        break;\n      }\n    }\n\n    this.selected.cursor.staveIndex = sIndex;\n    this.selected.cursor.noteIndex = nIndex;\n    let selectedNote = this.sheet.staves[sIndex].notes[nIndex]\n\n    this._addtoSelectedNotes(selectedNote)\n\n\n\n\n  }\n\n  _cursorBack() {\n    let sIndex = this.selected.cursor.staveIndex;\n    let nIndex = this.selected.cursor.noteIndex;\n\n    switch (true) {\n      case nIndex > 0: {\n        nIndex = nIndex - 1;\n        break;\n      }\n      case nIndex === 0 && sIndex > 0: {\n        \n          sIndex = sIndex - 1;\n          nIndex = this.sheet.staves[sIndex].notes.length - 1;\n        \n        break;\n      }\n    }\n    \n    this.selected.cursor.staveIndex = sIndex;\n    this.selected.cursor.noteIndex = nIndex;\n    let selectedNote = this.sheet.staves[sIndex].notes[nIndex]\n    this._addtoSelectedNotes(selectedNote)\n  }\n\n  // add keyboard controls\n  addKeyboardListeners() {\n\n  \n    document.addEventListener(\"keyup\", (event) => {\n\n      \n\n      let noteMatch = event.key.length === 1 ? event.key.match(/[abcdefg]/) : null;\n\n      switch (true) {\n        case event.key === \"ArrowRight\": {\n          this._cursorForward();\n          this.Draw();\n          break;\n        }\n\n        case event.key === \"ArrowLeft\": {\n          this._cursorBack();\n          this.Draw();\n          break;\n        }\n\n        case event.key === \"Backspace\": {\n          this.saveState()\n          this.deleteNotes();\n          this.Draw();\n          break;\n        }\n\n        case event.key === \"s\": {\n          if(!event.ctrlKey) return;\n          this.saveState()\n          this.splitSelectedNote();\n          this.Draw();\n          break\n        }\n\n        case event.key === \"j\": {\n          if(!event.ctrlKey) return;\n          this.saveState()\n          this.mergeNotes();\n          this.Draw();\n          break\n        }\n\n        // undo and redo\n\n        case event.key === \"z\": {\n          if(!event.ctrlKey && !event.metaKey ) return;\n          this.undo();\n          this.Draw();\n          break\n        }\n\n        case event.key === \"r\": {\n          if(!event.ctrlKey && !event.metaKey ) return;\n          this.redo();\n          this.Draw();\n          break\n        }\n\n        // enable accidentals accordingly \n\n        case event.key === \"B\"  || event.key === \"#\"  || event.key === \"N\" : {\n          if(!event.shiftKey ) return;\n          \n          let key = event.key.toLowerCase();\n\n          switch(true){\n            case this.accidental === null : this.accidental = key ; break;\n            case this.accidental  && this.accidental.indexOf(key) < 0 : this.accidental = key; break;\n            case key === \"b\":\n                this.accidental = this.accidental === \"b\" && this.accidental === key ? this.accidental = \"bb\" :  null  ; break;\n            case key === \"#\":\n                this.accidental = this.accidental === \"#\" && this.accidental === key? this.accidental = \"##\" :  null; break;\n            case key === \"n\":\n                  this.accidental = this.accidental ===\"n\" ? this.accidental = null : this.accidental = \"n\" ; break;\n            \n          }\n          console.log(this.accidental)\n\n          break;\n        }\n\n        // for adding note s \n        case noteMatch && noteMatch.length === 1: {\n          this.saveState();\n          this.addNote(`${event.key.toLowerCase()}/4` )\n          this.Draw();\n          break;\n        } \n\n        case event.key === \"Control\": this.ctrlActive = false; break;\n        case event.key === \"Shift\": this.shiftActive = false; break;\n        case event.key === \"Meta\": this.metaActive = false; break;\n\n      }\n\n      document.addEventListener(\"keydown\",(event)=>{\n        switch(true){\n        case event.key === \"Control\": this.ctrlActive = true; break;\n        case event.key === \"Shift\": this.shiftActive = true; break;\n        case event.key === \"Meta\": this.metaActive = true; break;\n        }\n      })\n\n      \n    });\n\n\n  }\n}\n\nexport default Editor;\n"]}