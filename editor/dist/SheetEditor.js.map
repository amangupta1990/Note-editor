{"version":3,"file":"SheetEditor.js","sourceRoot":"","sources":["../src/SheetEditor.ts"],"names":[],"mappings":"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","sourcesContent":["/* eslint-disable */\n\n\n\n\n\nimport Vex from \"vexflow\";\nimport * as lodash from \"lodash\";\nimport {Chord, interval, Note} from \"@tonaljs/tonal\"\nimport {playChord} from './AudioEngine';\n\n\nconst REST_POSITIONS = (key:string)=>{\n\nswitch(key.toLocaleLowerCase()){\n  case \"q\":  return \"b/4\";\n  case \"h\":  return \"b/4\";\n  case \"w\": return \"e/5\";\n  case \"8\": return \"b/4\";\n  case \"16\":  return \"b/4\";\n  case \"32\":  return \"b/4\";\n  default: return \"\";\n}\n};\n\nconst NOTE_VAlUES =  (key:string)=>{\n    switch(key.toLocaleLowerCase()){ \n  case \"c\": return 1;\n  case \"d\": return 2;\n  case \"e\": return 3;\n  case \"f\": return 4;\n  case \"g\": return 5;\n  case \"a\": return 6;\n  case \"b\": return 7;\n  default: return 0;\n    }\n}\n\nconst DURATION_VALUES =  (key:string)=>{\n  switch(key.toLocaleLowerCase()){ \ncase \"w\": return 32;\ncase \"h\": return 16;\ncase \"q\": return 8;\ncase \"8\": return 4;\ncase \"16\": return 2;\ncase \"32\": return 1;\ndefault: return 0;\n  }\n}\n\n// types  \ninterface ed_note{\n    clef: any; \n    duration : string,\n    keys: string[],\n    accidentals: ( string | null )[],\n    dotted?: boolean;\n    isRest: boolean,\n    staveIndex: number,\n    noteIndex: number\n }\n\n interface ed_tie{\n   [x: string]: any;\n   first_note: ed_selected_note,\n   last_note: ed_selected_note,\n   first_indices: number[],\n   last_indices: number[]\n }\n\n interface ed_beam{\n    notes: ed_note[];\n }\n\ninterface ed_selected_note {staveIndex:number, noteIndex:number};\n  \n\n\n interface ed_stave{\n     notes:ed_note[]\n }\n\n interface ed_sheet{\n     staves: ed_stave[],\n     ties: ed_tie[]\n     beams: ed_beam[],\n }\n\n interface cursor{\n     _staveIndex?: number,\n     _noteIndex?: number,\n     noteIndex: any,\n     staveIndex:any\n }\n\ninterface ed_selected {\n    _staves?: any[]\n    _notes?: {staveIndex:number, noteIndex:number}[],\n    cursor: cursor,\n    notes: {staveIndex:number, noteIndex:number}[],\n    staves: number[],\n}\n\n interface ed_state {\n     sheet: string,\n     selected: string\n }\n\n\n\nclass Editor {\n  //eslint-disable-next-line\n  private onError:any;\n  private keySig:string = \"C\";\n  private timeSigTop: number = 4;\n  private timeSigBottom: number = 4;\n  private clef:string = \"treble\";\n  private accidental:(string | null) = \"\";\n  private mode = \"note\";\n  private staveWidth:number = 400;\n  private staveHeight:number = 140;\n  private noteWidth:number = 100;\n  private dotted:boolean = false;\n  private eventsAdded = false;\n  private shiftActive = false;\n  private ctrlActive = false;\n  private metaActive = false;\n  private svgElm:HTMLElement;\n  private renderer:any;\n  private ctx:Vex.Flow.CanvasContext;\n  private  sheet: ed_sheet= { \n    staves: [],\n    ties: [],\n    beams: []\n  }\n\n  private  states:ed_state[]= [];\n  private  undoStates:ed_state[] = []\n\n  private  selected: ed_selected = {\n    _staves: [] as ed_stave[],\n    _notes:[{staveIndex: 0 , noteIndex: 0}],\n    cursor:{\n      _staveIndex: 0,\n      _noteIndex:0,\n\n      set noteIndex(value:any){ this._noteIndex = parseInt(value)},\n      get noteIndex(){\n        return this._noteIndex},\n      set staveIndex(value:any){ this._staveIndex = parseInt(value)},\n      get staveIndex(){ \n        return this._staveIndex\n      }\n\n    },\n\n    get notes(){\n        return this._notes?.map(n=> {\n          return {...n, staveIndex: n.staveIndex, noteIndex: n.noteIndex } }) as  ed_note[]\n    },\n\n    set notes(value){\n      if(!lodash.isArray(value)) this._notes = this._notes;\n      else {\n        \n        const sortedNotes = value.sort((a,b)=> a.noteIndex - b.noteIndex);\n        this._notes = sortedNotes; }\n    },\n\n    get staves(){\n      return this._staves?.map(s=> parseInt(s))\n    },\n\n    set staves(value:any) {\n        this._staves = value;\n    }\n\n  };\n\n  mousePos:any = {\n    previous:{\n      x:0,\n      y:0,\n    },\n    current:{\n      x:0,\n      y:0\n    }\n  };\n\n\n    // callbacks \n    public onRender!: Function;\n    public onNoteSelected!: Function;\n    public onStaveSelected!:Function;\n\n  constructor(svgcontainer:HTMLElement,opts:{ timeSig:string, key:string , errorHandler: Function, onRender:Function, onNoteSelected: Function, onStaveSelected:Function }) {\n\n    let time = opts?.timeSig.split(\"/\");\n    this.timeSigTop =  time ? parseInt(time[0])  : this.timeSigTop;\n    this.timeSigBottom = time ? parseInt(time[1])  : this.timeSigBottom;\n    this.keySig = opts?.key || this.keySig;\n    this.svgElm = svgcontainer;\n    this.onError = opts?.errorHandler;  \n    this.onRender = opts?.onRender;\n    this.onNoteSelected = opts?.onNoteSelected;\n    this.onStaveSelected = opts?.onStaveSelected;\n\n     this.renderer   = new Vex.Flow.Renderer(\n        svgcontainer,\n        Vex.Flow.Renderer.Backends.SVG\n      );\n\n     this.ctx = this.renderer.getContext();\n\n    // event listerners\n\n    // add first stave by default\n    this._addStave();\n\n\n    if (!this.eventsAdded) {\n      this.addEventListeners(this.svgElm);\n      this.eventsAdded = true;\n    }\n\n      \n    this.Draw()\n    \n  }\n\n  saveState(){\n    const sheet = JSON.stringify(this.sheet);\n    const selected = JSON.stringify(this.selected);\n    this.states.push({sheet,selected}) ; console.log(\"state saved\",this.states);\n  }\n  \n\n  undo(){\n    if(!this.states.length) return;\n    const currState ={\n      sheet: JSON.stringify(this.sheet),\n      selected: JSON.stringify(this.selected)\n    }\n\n    this.undoStates.push(currState)\n\n    const previousState = this.states.pop()\n    if(previousState){\n    this.sheet = JSON.parse(previousState.sheet)\n    this.selected = JSON.parse(previousState.selected)\n    this.Draw();\n    }\n  }\n\n  redo(){\n    if(!this.undoStates.length) return;\n    this.saveState();\n    const undoSate:any = this.undoStates.pop();\n    this.sheet = JSON.parse(undoSate.sheet);\n    this.selected = JSON.parse(undoSate.selected);\n\n  }\n\n  _addStave(index = this.sheet.staves ? this.sheet.staves.length : 0) {\n    this.sheet.staves = this.sheet.staves || [];\n    \n    // fill bar with rests\n    const durationValue = this.timeSigBottom == 4 ? \"q\" : \"8\";\n    \n\n    let notes:ed_note[] = new Array(this.timeSigTop).fill({keys:[REST_POSITIONS(durationValue)] ,duration:durationValue,isRest:true})\n                            .map((n,i)=> { return  {...n,accidentals:[null],staveIndex:index, noteIndex:i} })\n    this.sheet.staves.splice(index, 0, {notes});\n  }\n\n  setMode( mode: \"chord\" | \"note\" | \"rythm\" ){\n      this.mode = mode;\n  }\n\n  private _addNote(noteName:string,accidental:any  = null) {\n    // modify the rest of the stave to join the notes\n\n    let notes = this.selected.notes;\n    notes = notes.map((selectedNote:ed_selected_note)=>{\n\n    const  staveIndex = selectedNote.staveIndex;\n    const noteIndex = selectedNote.noteIndex;\n    const note = this.sheet.staves[staveIndex].notes[noteIndex];\n    // if key arledy exists then don't add it again;\n\n    let noteToAdd;\n  \n    if(noteName.indexOf(\"/\") == -1){\n    const sortedNotes = Note.sortedNames(note.keys.map(k=> k.split(\"/\").join('')), Note.descending  );\n    const [currentKey, o] =  sortedNotes[0].split('');\n    const currOctave = parseInt(o);\n    let oct;\n\n    if(note.isRest) {\n      oct = 4;\n    }\n    else{\n      switch(this.compareNotes(`${currentKey}${currOctave}`, `${noteName}${currOctave}`)){\n        \n        case -1 :  oct= currOctave; break;\n        case 0:\n        case 1 :   oct = currOctave+1; break;\n                  \n      }\n    }\n    noteToAdd = `${noteName}/${oct}`\n    }\n    else{\n      noteToAdd = noteName;\n    }\n\n    \n\n    let stave = this.sheet.staves[note.staveIndex];\n    let isRest = note.isRest;\n    let duration =  note.duration.replace('r','');\n    let keys = isRest ? [noteToAdd] :   lodash.uniq([...note.keys, noteToAdd]);\n    let accidentals:any[] = [];\n\n    switch(true){\n      case isRest: accidentals = [accidental || null]; break;\n      case !isRest: accidentals = [...note.accidentals, accidental || null]; break;\n    }\n   \n\n    let newNote = {keys,duration,isRest:false,staveIndex:  note.staveIndex,noteIndex: note.noteIndex, accidentals, clef: note.clef, dotted: note.dotted};\n    stave.notes[note.noteIndex] = newNote;\n    this.sheet.staves[note.staveIndex] = stave;\n    return newNote;\n\n  })\n  this.selected.notes = notes;\n\n  // play the notes:\n  \n  return this.getToneNotes(notes as ed_note[]);\n  }\n\n  private getToneNotes(notes:ed_note[]){\n      \n  const tone_notes = (notes).map((n,i)=>n.keys.map(k=> {\n    const accidental = n.accidentals[i] || '';\n    const [note , oct] = k.split(\"/\");\n    return `${note}${accidental}${oct}`\n    }))\n    return tone_notes;\n  }\n\n  private _addChord(tonic:string,chord:string){\n    \n\n    this._deleteNotes();\n\n    const tone_chords:string[] = [];\n    const _chord = Chord.getChord(chord, tonic+\"4\");\n    const root:any = _chord.tonic;\n    _chord.intervals.map((interval:string,index:number)=> {\n      const n = Note.transpose(root,interval);\n      let [ _note, octave]= n.split(/(?=[0-9])/g);\n      let [ note , accidental] = _note.split('');\n      this._addNote(`${note}/${octave}`,accidental);\n      tone_chords.push(`${note}${octave}`);\n    } )\n    this.Draw();\n    return tone_chords;\n  }\n\n  \n  private _tieNotes(){\n\n    const getId = (a:ed_selected_note,b:ed_selected_note)=>{\n        return `${a.staveIndex}${b.staveIndex}_${a.noteIndex}${b.noteIndex}`;\n    }\n    \n    const ties:any = []\n    if(this.selected.notes.length <= 1)\n      {\n        this.throwError(\"a tie must be between two notes atleast\")\n        return ;\n      }\n\n      // if a tie already exists then remove it \n\n      for(let i = 0; i < this.selected.notes.length - 1; i++ ){\n        ties.push({\n          id: getId(this.selected.notes[i],this.selected.notes[i+1]),\n          first_note: this.selected.notes[i],\n          last_note: this.selected.notes[i+1],\n          first_indices: [0],\n          last_indices: [0]\n        })\n      }\n\n      let existingTies = this.sheet.ties.filter(st=> ties.find((t:ed_tie)=> t.id === st.id )!= null  )\n\n      if(existingTies.length){\n\n      this.sheet.ties = this.sheet.ties.filter(t=>   existingTies.find(et=>  et.id === t.id  )==null  )\n      }\n      else{\n        let concatedTies  = lodash.concat(this.sheet.ties,ties)\n        this.sheet.ties = concatedTies;\n      }\n      \n\n\n  \n  }\n\n // note editing functions \n\n  changeOctave(octave:number,keyNote:string){\n\n\n   this.selected.notes.map(selectedNote=>{\n\n      const staveIndex = selectedNote.staveIndex;\n      const noteIndex = selectedNote.noteIndex;\n      const keyIndex = this.sheet.staves[staveIndex].notes[noteIndex].keys.indexOf(keyNote);\n      const note = this.sheet.staves[staveIndex].notes[noteIndex].keys[keyIndex]\n\n      if(!note){\n        this.throwError(\"note not found\");\n        return;\n      }\n\n      const [upper , lower ] = note.split(\"/\");\n\n\n      const newNote = `${upper}/${parseInt(lower)+octave}`;\n\n      // replace the note \n\n    this.sheet.staves[staveIndex].notes[noteIndex].keys[keyIndex] = newNote;\n  \n          \n    })\n\n  }\n\n  replaceNote(currentNote:string, newNote: string){ \n\n    this.selected.notes.map(selectedNote=>{\n\n      const staveIndex = selectedNote.staveIndex;\n      const noteIndex = selectedNote.noteIndex;\n      const keyIndex = this.sheet.staves[staveIndex].notes[noteIndex].keys.indexOf(currentNote);\n      const note = this.sheet.staves[staveIndex].notes[noteIndex].keys[keyIndex]\n\n      if(!note){\n        this.throwError(\"note not found\");\n        return;\n      }\n\n      // replace the note \n\n    this.sheet.staves[staveIndex].notes[noteIndex].keys[keyIndex] = newNote;\n  \n          \n    })\n\n  }\n\n  changeaccidental(key:string, accidental: string){ \n\n    // check if accidental type is invalid\n\n    switch(true){\n      case accidental === \"n\":\n      case accidental === \"b\":\n      case accidental === \"bb\":\n      case accidental === \"#\":\n      case accidental === \"##\":\n      case accidental === null : break;\n      default : {\n        this.throwError(\"incorrect accidnetal value\");\n        return ;\n      }\n    }    \n\n    this.selected.notes.map(selectedNote=>{\n\n      const staveIndex = selectedNote.staveIndex;\n      const noteIndex = selectedNote.noteIndex;\n      const keyIndex = this.sheet.staves[staveIndex].notes[noteIndex].keys.indexOf(key);\n      const accidentalIndex = keyIndex;\n      const note = this.sheet.staves[staveIndex].notes[noteIndex].keys[keyIndex]\n\n      if(!note){\n        this.throwError(\"note not found\");\n        return;\n      }\n\n      // replace the note \n    this.sheet.staves[staveIndex].notes[noteIndex].accidentals[accidentalIndex] = accidental;\n  \n          \n    })\n\n  }\n\n\n  private _deleteNotes() {\n    // convert the note into a rest\n    let notes = this.selected.notes;\n    notes = notes.map((note:ed_selected_note)=>{\n\n    let stave = this.sheet.staves[note.staveIndex];\n    let oldNote = stave.notes[note.noteIndex];\n    let newNote:ed_note = {\n      keys: [REST_POSITIONS(oldNote.duration)],\n      duration: oldNote.duration,\n      isRest:true,\n      staveIndex:oldNote.staveIndex,\n      noteIndex: oldNote.noteIndex,\n      accidentals: [],\n      clef: oldNote.clef\n    }\n    stave.notes[note.noteIndex] = newNote;\n    this.sheet.staves[note.staveIndex] = stave;\n    return newNote;\n  })\n\n  this.selected.notes = notes;\n\n    \n  }\n\n  // note sorting fuction \n\n private   compareNotes (noteA:string, noteB:String) {\n    const toneA = noteA.charAt(0).toLocaleLowerCase();\n    const toneB = noteB.charAt(0).toLocaleLowerCase();\n    const octaveA = parseInt(noteA.charAt(1));\n    const octaveB = parseInt(noteB.charAt(1));\n  \n    if (octaveA === octaveB) {\n      // console.log('same octave');\n      if ( NOTE_VAlUES(toneA) > NOTE_VAlUES(toneB)) {\n        return 1;\n      } else if ( toneA == toneB) {\n        return 0;\n      } else {\n        return -1;\n      }\n    } else if (octaveA > octaveB) {\n      return 1;\n    } else {\n      return -1;\n    }\n  }\n\n  Draw() {\n\n    try{\n\n    this.ctx.clear();\n    let staveXpos = 10;\n    let staveWidth = 0;\n    // increase the width of the svg element to fit staves\n    this.svgElm.style.width = `${(this.sheet.staves.length)*(this.timeSigTop*200)}`\n    const renderedStaves =   this.sheet.staves.map((s, staveIndex) => {\n\n      \n      staveXpos += staveWidth;\n      staveWidth = this.noteWidth*(s.notes.length  < this.timeSigBottom ? this.timeSigBottom :  s.notes.length   );\n      // drave the stave first , add timesignature\n      let stave = new Vex.Flow.Stave(\n        staveXpos,\n        40,\n        staveWidth \n      );\n      (stave as unknown as HTMLElement).setAttribute(\"id\", \"vf-\" + staveIndex);\n    \n\n      if(staveIndex === 0){\n\n          \n\n          stave.addTimeSignature(`${this.timeSigTop}/${this.timeSigBottom}`);\n          stave.addClef(this.clef);\n          stave.addKeySignature( lodash.capitalize(this.keySig));\n      }\n\n      stave.setContext(this.ctx).draw(); \n\n      //add selectable overlay\n      (this.ctx as any).rect(stave.getX(), (stave as any).y , stave.getWidth(), this.staveHeight, {\n        class: \"vf-measureRect\",\n        id: \"vf-\" + staveIndex,\n        fill: \"transparent\",\n      });\n\n      // draw the notes \n\n      const  renderedNotes =  s.notes.map(n=>{\n\n\n       // sort notes according to keys\n       n.accidentals = n.accidentals || [null];\n       let keys = n.keys.map((k,i)=> {return { index:i, key: k, accidental: n.accidentals[i]  }});\n       keys = keys.sort((a,b)=> this.compareNotes( a.key.split(\"/\").join('') , b.key.split(\"/\").join('') ) );\n\n       let sortedKeys = keys.map(k=>k.key);\n       let sortedAccidentals:any = keys.map(k=>k.accidental)\n\n       let  staveNote: Vex.Flow.StaveNote | any = new Vex.Flow.StaveNote({\n          clef: this.clef,\n          keys: sortedKeys,\n          duration: !n.isRest? n.duration : n.duration+\"r\",\n          auto_stem: true,\n        });\n\n        // add accidental \n\n        !n.isRest && sortedAccidentals.length && keys.map((accidental,index)=>{\n          if(sortedAccidentals[index])\n          staveNote.addAccidental(index, new Vex.Flow.Accidental(sortedAccidentals[index]))\n        })\n\n        // add dot if dotted\n        \n        if (n.dotted){\n            (staveNote as Vex.Flow.StaveNote).addDotToAll();\n        }\n\n        staveNote.setAttribute(\"id\", `${n.staveIndex}__${n.noteIndex}`);\n        return staveNote\n       })\n    \n\n       //automatic beaming \n\n       var formatter = new Vex.Flow.Formatter();\n       var notes = renderedNotes\n       var voice = new Vex.Flow.Voice({num_beats: this.timeSigTop, beat_value:this.timeSigBottom, resolution: Vex.Flow.RESOLUTION}).setMode(renderedNotes.length);\n       \n       voice.addTickables(notes);\n       formatter.joinVoices([voice]).formatToStave([voice], stave);\n\n\n       const beams = Vex.Flow.Beam.generateBeams(notes, {\n        beam_rests: true,\n        beam_middle_only: true\n      });\n\n       \n\n       voice.draw(this.ctx, stave);\n       beams.map(b=> b.setContext(this.ctx).draw())\n\n       \n\n       return {\n         notes: renderedNotes\n       }\n      \n\n    });\n\n\n   \n\n    const ties = this.sheet.ties.map(t=>{\n      return new Vex.Flow.StaveTie ({\n       first_note: renderedStaves[t.first_note.staveIndex].notes[t.first_note.noteIndex],\n       last_note: renderedStaves[t.last_note.staveIndex].notes[t.last_note.noteIndex],\n       first_indices: t.first_indices,\n       last_indices: t.last_indices\n      })\n    })\n   \n    ties.map((t) => {t.setContext(this.ctx).draw()})\n\n    \n    // highlight the selected notes\n    this.selected.notes.map((sn:ed_selected_note)=>{\n      let selectedNote:any = this.svgElm.querySelector(\n        `#vf-${sn.staveIndex}__${\n          sn.noteIndex\n        }`\n      );\n      this._highlightNoteElement(selectedNote, \"red\");\n    })\n\n\n    this.selected.staves.map((staveIndex:number)=>{\n      this._highlightStaveElement(\n        this.svgElm.querySelector(\n          `#vf-${staveIndex}`\n        ),\n        \"lightblue\"\n      );\n    })\n\n    \n  }\n  catch(e){\n\n    this.throwError(e.message);\n    this.undo()\n  }\n\n\n  }\n\n private  _getSelectedElement(event:any) {\n    try{\n    let ele = event.target;\n    while (\n      ele.classList.value.indexOf(\"vf-stavenote\") < 0 &&\n      ele.classList.value.indexOf(\"vf-measureRect\") < 0\n    ) {\n      ele = ele.parentElement;\n    }\n\n    // prevent the cursor note form getting selected\n    let id = ele.id;\n    if (id.indexOf(\"auto\") > -1) return [];\n\n    id = id.split(\"-\")[1].split(\"__\");\n\n    // return an element only if there is a valid id selected\n    return [\n      ele,\n      ele.classList.value.indexOf(\"vf-stavenote\") > -1 ? \"note\" : \"stave\",\n      ...id,\n    ];\n  }\n  catch(e){\n    console.error(e)\n  }\n  }\n\n private  _highlightNoteElement(ele:(HTMLElement | null), color:string = \"black\") {\n    if (!ele) {\n      console.warn(\"No element was passed\");\n      return;\n    }\n    ele.querySelectorAll(\"*\").forEach((e:any) => {\n      e.style.fill = color;\n      e.style.stroke = color;\n    });\n  }\n\n  // eslint-disable-next-line no-unused-vars\n private _highlightStaveElement(ele:any, color = \"transparent\") {\n    ele.style.fill = color;\n    ele.style.opacity = \"0.4\";\n  }\n\n  addEventListeners(svgElem:HTMLElement) {\n    // helper function for finding the selected element:\n\n    svgElem.addEventListener(\"click\", (event) => {\n      event.preventDefault();\n      // eslint-disable-next-line no-unused-vars\n      let [ele, type, staveIndex, noteIndex] = this._getSelectedElement(event);\n\n      switch (type) {\n        case \"note\": {\n\n\n\n          //  \n          this.selected.cursor.staveIndex = staveIndex;\n          this.selected.cursor.noteIndex = noteIndex;\n          \n          this._addtoSelectedNotes(  this.sheet.staves[staveIndex].notes[noteIndex])\n          break;\n        }\n\n        case \"stave\": {\n     \n\n          this._addtoSelectedStaves(staveIndex);\n          break;\n        }\n      }\n      this.Draw();\n\n    },false);\n\n    svgElem.addEventListener(\"blur\", () => {\n      this.Draw();\n    });\n\n  }\n\n  // Methods for drawing cursor note\n\n  private _addtoSelectedNotes(note:ed_note,shiftActive?:boolean){\n    if(shiftActive){\n      let notes = lodash.clone(this.selected.notes);\n      notes.push(note)\n      notes = lodash.uniq(notes);\n      this.selected.notes = notes;\n    }\n    else{\n      this.selected.notes = [note];\n    }\n\n    // get the xy of the ntoes and output them \n    let notes = this.selected.notes.map(sn=>{\n     let ele:any = this.svgElm.querySelector(\n        `#vf-${sn.staveIndex}__${\n          sn.noteIndex\n        }`\n      );\n\n      const bbox = ele?.getBBox();\n\n        return {\n          ...sn,\n          x : bbox.x,\n          y: bbox.y\n        }\n\n    })\n   \n    this.onNoteSelected && this.onNoteSelected(notes);\n\n  }\n\n  private _addtoSelectedStaves(stave:number){\n    if(this.shiftActive){\n      let staves = lodash.clone(this.selected.staves);\n      staves.push(stave)\n      staves = lodash.uniq( staves );\n      this.selected.staves = staves;\n    }\n    else{\n      this.selected.staves = [stave];\n    }\n\n    this.onStaveSelected && this.onStaveSelected(this.selected.staves);\n  }\n\n  getMousePos(canvas:HTMLElement, evt:MouseEvent) {\n    var rect = canvas.getBoundingClientRect();\n    return {\n      x: evt.clientX - rect.left,\n      y: evt.clientY - rect.top,\n    };\n  }\n\n\n   private _splitSelectedNote(){\n    let stave = this.sheet.staves[this.selected.cursor.staveIndex];\n    let notes = stave.notes;\n    let selectedNote = stave.notes[this.selected.cursor.noteIndex];\n    let duration = selectedNote.duration.replace('r','') ;\n    let keys = selectedNote.keys;\n    let accidentals = selectedNote.accidentals;\n    let isRest = selectedNote.isRest;\n    let clef = selectedNote.clef;\n    let newNotes = new Array(2).fill(null)\n    // create a new duration\n\n    switch(duration){\n      case \"w\": duration = \"h\"; break;\n      case \"h\": duration= \"q\"; break;\n      case \"q\":  duration =\"8\"; break;\n      case \"8\": duration = \"16\"; break;\n      case \"16\": duration = \"32\"; break;\n      default: return ;\n    }\n\n    newNotes = newNotes.map( () => { return {\n      clef,\n      keys,\n      duration,\n      isRest,\n      accidentals\n\n    }\n    })\n\n  notes.splice(this.selected.cursor.noteIndex,1,...newNotes);\n  stave.notes = notes;\n  this._remapIds()\n  // this.setCursor(this.selected.cursor.staveIndex,this.selected.cursor.noteIndex+1);\n\n    \n  }\n\n\n private _remapIds(){\n\n const staves =  this.sheet.staves.map((stave:ed_stave,staveIndex: number)=>{\n\n    const notes = stave.notes.map((note:ed_note, noteIndex: number)=>{\n\n        note.staveIndex = staveIndex;\n        note.noteIndex= noteIndex;\n        return note;\n        \n      })\n\n      stave.notes = notes;\n      return stave; \n        \n    })\n\n    this.sheet.staves = staves;\n\n\n }\n\n  private _mergeNotes(){\n\n      const selectedNotes: ed_note[] = this.selected.notes.map(sn=> {\n\n        const  staveIndex = sn.staveIndex;\n        const noteIndex = sn.noteIndex;\n        const note = this.sheet.staves[staveIndex].notes[noteIndex];\n        return note ;\n      })\n\n      const newNote:ed_note = selectedNotes.reduce((a:any,b:any)=>{\n\n          let mergedDuration:string='';\n          let mergedDurationValue: number =\n            DURATION_VALUES(a.duration) + DURATION_VALUES(b.duration)\n            let dotted = false;\n\n    \n          switch(mergedDurationValue){\n\n          // cases for regular notes \n            \n            case 2 : mergedDuration = \"16\"; break;\n            case 4 : mergedDuration =  \"8\"; break;\n            case 8 : mergedDuration = \"q\"; break;\n            case 16: mergedDuration = \"h\"; break;\n            case 32: mergedDuration = \"w\"; break;\n\n          // handle cases for dotted notes \n\n          //dotted 16th note\n\n          case 3: mergedDuration = \"16\" ; dotted = true; break;\n          //dotted 8th note\n          case 6: mergedDuration = \"8\"; dotted = true; break;\n          // dotted quater ntoe \n          case 12: mergedDuration = \"q\"; dotted = true; break;\n          // dotted half note  \n          case 24: mergedDuration = \"h\"; dotted = true; break;\n          \n\n          }\n\n          if(!mergedDuration){\n            console.warn(\"cannot merge\");\n            return ;\n          }\n\n         let keys1 = a.isRest?  [] : a.keys;\n         let keys2 = b.isRest? [] : b.keys;\n         let  keys  = [...keys1, ...keys2];\n          keys = keys.length ? lodash.uniq(keys) : [REST_POSITIONS(mergedDuration)] ;\n     \n\n          return {\n            ...a,\n            isRest: a.isRest && b.isRest,\n            keys,\n            duration:mergedDuration,\n            dotted,\n\n        }\n          \n      })\n\n\n      newNote.staveIndex =  this.selected.notes[0].staveIndex;\n      newNote.noteIndex = this.selected.notes[0].noteIndex;\n\n      this.sheet.staves[this.selected.notes[0].staveIndex].notes.splice(this.selected.notes[0].noteIndex,this.selected.notes.length,newNote)\n      this.selected.notes = [newNote]\n\n      // re-calcualte note id's \n\n      this._remapIds();\n\n\n  }\n\n  private _setCursor(staveIndex:number,noteIndex:number){\n    this.selected.cursor ={\n      staveIndex: staveIndex,\n      noteIndex: noteIndex\n    }\n    let selectedNote = this.sheet.staves[staveIndex].notes[noteIndex]\n    this._addtoSelectedNotes(selectedNote)\n  }\n\n  getCursorNote() {\n      //TODO this is depricated;\n    let staveIndex = this.selected.cursor.staveIndex;\n    let noteIndex = this.selected.cursor.noteIndex;\n    if (!staveIndex && noteIndex) return [];\n    // find the mouse position and return the correct note for that position.\n    var y= 0;\n    var found;\n    var cursorNoteKey;\n    // var y = this.selected.measure.y;\n    var notesArray = [\"c/\", \"d/\", \"e/\", \"f/\", \"g/\", \"a/\", \"b/\"];\n    var count = 0;\n\n    for (var i = 5; i >= 0; i--) {\n      for (var l = 0; l < notesArray.length; l++) {\n        var noteOffset = count * 35 - (l * 5 - 17);\n        if (\n          this.mousePos.current.y >= y + noteOffset &&\n          this.mousePos.current.y <= 5 + y + noteOffset\n        ) {\n          cursorNoteKey = notesArray[l] + (i + 1);\n          found = true;\n          break;\n        }\n        if (found == true) {\n          break;\n        }\n      }\n      count++;\n    }\n    return [cursorNoteKey, staveIndex, noteIndex];\n  }\n\n  // cursor manipulation methods\n  _cursorForward(shiftKey:boolean) {\n    let sIndex = this.selected.cursor.staveIndex;\n    let nIndex = this.selected.cursor.noteIndex;\n    \n\n    switch (true) {\n      case nIndex < this.sheet.staves[sIndex].notes.length - 1: {\n        nIndex = nIndex + 1;\n        break;\n      }\n      case nIndex === this.sheet.staves[sIndex].notes.length - 1: {\n        if (sIndex < this.sheet.staves.length - 1) {\n          sIndex = sIndex + 1;\n          nIndex = 0;\n        }\n        break;\n      }\n    }\n\n    this.selected.cursor.staveIndex = sIndex;\n    this.selected.cursor.noteIndex = nIndex;\n    let selectedNote = this.sheet.staves[sIndex].notes[nIndex]\n\n    this._addtoSelectedNotes(selectedNote,shiftKey)\n\n\n\n\n  }\n\n  _cursorBack(shiftKey:boolean) {\n    let sIndex = this.selected.cursor.staveIndex;\n    let nIndex = this.selected.cursor.noteIndex;\n\n    switch (true) {\n      case nIndex > 0: {\n        nIndex = nIndex - 1;\n        break;\n      }\n      case nIndex === 0 && sIndex > 0: {\n        \n          sIndex = sIndex - 1;\n          nIndex = this.sheet.staves[sIndex].notes.length - 1;\n        \n        break;\n      }\n    }\n    \n    this.selected.cursor.staveIndex = sIndex;\n    this.selected.cursor.noteIndex = nIndex;\n    let selectedNote = this.sheet.staves[sIndex].notes[nIndex]\n    this._addtoSelectedNotes(selectedNote,shiftKey)\n  }\n\n\n  withStateSave(func:Function)  : Function  {\n    return (...args:any[])=>{\n      this.saveState();\n      let res = func.apply(this,args);\n      return res;\n    }\n  }\n\n  withDraw(func:Function)  : Function  {\n    return (...args:any[])=>{\n      let res = func.apply(this,args);\n      this.Draw();\n      return res;\n    }\n  }\n\n\n\n  API(){\n    return {\n      addStave : this.withDraw(this.withStateSave(this._addStave)),\n      addNote: this.withDraw(this.withStateSave(this._addNote)),\n      addChord: this.withDraw(this.withStateSave(this._addChord)),\n      splitSelectedNote: this.withDraw(this.withStateSave(this._splitSelectedNote)),\n      mergeNotes: this.withDraw(this.withStateSave(this._mergeNotes)),\n      undo: this.withDraw(this.undo),\n      redo: this.withDraw(this.redo),\n      deleteNotes: this.withDraw(this.withStateSave(this._deleteNotes)),\n      cursorBack: this.withDraw(this._cursorBack),\n      cursorForward: this.withDraw(this._cursorForward),\n      setCursor: this.withDraw(this._setCursor),\n      playback : playChord\n\n    }\n  }\n\n  throwError(message:string){\n    this.onError && this.onError(message);\n  }\n\n\n  \n}\n\nexport default Editor;\n"]}